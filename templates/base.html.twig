<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}CNSS Bénin{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  {% block stylesheets %}{% endblock %}
  <style>
    body {
      background-color: #f4f6f9;
      font-family: 'Segoe UI', sans-serif;
      overflow-x: hidden;
    }

    header.page-title {
      background: white;
      padding: 20px 30px;
      margin-bottom: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
    }

    header.page-title img {
      height: 60px;
      margin-right: 20px;
    }

    /* Fond avec image (par défaut) */
    .main-content {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
      background-image: url('/images/travailleurs.png');
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      background-color: rgba(204, 229, 255, 0.9);
      padding: 40px 15px;
      border-radius: 10px;
      width: 100%;
    }

    /* Fond bleu clair sans image, largeur pleine */
    .main-content.traitement {
      background-image: none !important;
      background-color: rgba(204, 229, 255, 0.9);
      width: 100%;
    }

    /* Fond bleu clair sans image, largeur normale */
    .main-content.no-image {
      background-image: none !important;
      background-color: rgba(204, 229, 255, 0.9);
      /* Largeur normale, pas de max-width 100% */
    }

    .form-wrapper {
      position: relative;
      z-index: 1;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 650px;
      width: 100%;
      margin: 0 auto;
    }

    /* Largeur pleine pour traitement sauf stat */
    .form-wrapper.full {
      max-width: 100% !important;
    }

    .form-actions {
      text-align: right;
      margin-top: 20px;
    }

    .alert {
      margin: 10px 0;
    }

    .content-wrapper {
      padding: 20px;
    }

    /* Hauteur augmentée pour les tables traitement */
    .table-wrapper.haute-table {
      min-height: 300px; /* ajusté à une valeur raisonnable */
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table td,
    table th {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }

    .form-row > div {
      flex: 1 1 300px;
    }
  </style>
</head>
<body>

<header class="page-title">
  <img src="{{ asset('images/logo-cnss.jpg') }}" alt="Logo CNSS">
  <div
    {% block page_title %}
      <h2 class="mb-0">CNSS – Bienvenue</h2>
      <p class="text-muted small">Caisse Nationale de Sécurité Sociale du Bénin</p>
    {% endblock %}
  </div>

  {% set current_route = app.request.attributes.get('_route') %}

  {% if is_granted('IS_AUTHENTICATED_REMEMBERED') and current_route != 'app_pers_phys_traitement_sstat' %}
    <div class="ms-auto">
      <a href="{{ path('app_pers_phys_traitement_sstat') }}" class="btn btn-primary">Admin</a>
    </div>
  {% elseif not is_granted('IS_AUTHENTICATED_REMEMBERED') and current_route != 'app_login' %}
    <div class="ms-auto">
      <a href="{{ path('app_login') }}" class="btn btn-primary">Se connecter</a>
    </div>
  {% endif %}
</header>

<div class="container mt-3">
  {% for label, messages in app.flashes %}
    {% for message in messages %}
      <div class="alert alert-{{ label == 'error' ? 'danger' : label }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endfor %}
</div>

<div class="main-content
  {% if current_route starts with 'app_pers_phys_traitement' and current_route != 'app_pers_phys_traitement_sstat' %}
    traitement
  {% elseif current_route == 'app_pers_phys_traitement_sstat' %}
    no-image
  {% endif %}
">
  <div class="form-wrapper content-wrapper
    {% if current_route starts with 'app_pers_phys_traitement' and current_route != 'app_pers_phys_traitement_sstat' %}
      full
    {% endif %}
  ">
    <div class="table-wrapper
      {% if current_route starts with 'app_pers_phys_traitement' and current_route != 'app_pers_phys_traitement_sstat' %}
        haute-table
      {% endif %}
    ">
      {% block body %}
      {% endblock %}
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
